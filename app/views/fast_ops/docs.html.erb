
<h3>Manage Attachments</h3>

<blockquote>

<% form_tag( { :action => 'upload_doc' }, { :enctype => 'multipart/form-data' } ) do %>
  <b>Local file path</b> <br /> 
  <input type="file" name="doc_file" size="70"/>

  <br/> <br/>
  <b>File name on server</b> <br/> 
  <input id="fname" type="text" name="filename" value="<%=@upload_name.to_s%>" size="30"/>
  <p style="margin:6px 0;"><i>Note: Leave this field empty to use the original file name</i></p>
  <input type="submit" name="save" value="Upload"/>
<% end %> <!-- end form_tag -->

<p style="margin:16px 0 8px 0;">File attachments can be included in text  
using the notation <code>{doc:filename}</code> (include the curly braces).  After inserting such a 
reference, the system presents a red link to upload the file, unless the file is already on the server, 
in which case the system will present a link to downlaod the file.</p> 

<hr />

<div style="float:left; margin:8px;">
  <h3>Existing attachments</h3>

  <ul style="list-style:none;">
    <% @files.each { |ifile| %>
       <li> 
         <%=link_to("<b>X</b>",{:action => 'delete_doc', :delete => ifile.to_s}, { :title => "Delete", :style => "color:maroon;" })%>
         <%=ifile.to_s%>&nbsp;<%= link_to("View", image_path(ifile.to_s).gsub("images","user_docs#{pub_segment()}"), { :target => "image_frame" } ) %>
       </li>
    <% } %>
  </ul>
</div>

<% if @files.size > 0 then %>
  <iframe name="image_frame" style="float:right; border:solid 2px gray;" width="360" height="280">No iframe Support</iframe>
<% end %>

<p class="spacer">&nbsp;</p>

</blockquote>

